---
title: "p8105_hw2_yh3683"
author: "Yining He"
date: "2024-10-01"
output: github_document
---

```{r}
library(tidyverse)
library(dplyr)
library(readxl)
library(janitor)

```


# Problem 1
```{r}
nyc_subway_data = read_csv("NYC_Transit_Subway_Entrance_And_Exit_Data.csv")

nyc_subway_data =janitor::clean_names(nyc_subway_data)

colnames(nyc_subway_data)

cleaned_data <- nyc_subway_data %>%
  select(line, station_name, station_latitude, station_longitude, route1, route2, route3, route4, route5, route6, route7, entry, vending, entrance_type, ada) %>%
  mutate(
    entry = ifelse(entry == "YES", TRUE, FALSE)  
  )
```

```{r}
view(cleaned_data)
```
#### Describe about the cleaned dataset:
**The dataset contains NYC subway station information, including line, station name, latitude/longitude, routes(Route1-Route7), entry status, vending, entrance type, and ADA compliance.** 

**Data cleaning involved standardizing column names, selecting relevant variables, and converting the entry variable to a logical TRUE/FALSE format. The cleaned dataset has 1,868 rows and 15 columns, and with each row representing a unique station entrance or exit.**

**But I don't think is tidy enough, because it still have many missing data (NA).**

```{r echo=TRUE}
distinct_stations <- cleaned_data %>% 
  distinct(station_name, line) 

n_distinct_stations <- nrow(distinct_stations)
n_distinct_stations

```
**The number of distinct stations are 465**

```{r echo=TRUE}
ada_compliant_stations <- cleaned_data %>%
  filter(ada == TRUE) %>%
  distinct(station_name, line)

n_ada_compliant_stations <- nrow(ada_compliant_stations)

n_ada_compliant_stations
```
**There are 84 ADA compliant stations.**


```{r}
no_vending_entrances <- cleaned_data %>%
  filter(vending == "NO")

proportion_allowing_entrance <- mean(no_vending_entrances$entry)
proportion_allowing_entrance
```
**The proportion of station entrances / exits without vending allow entrance is about 37.70.**

#### reform the data
```{r}
reformatted_data <- cleaned_data %>%
  pivot_longer(cols = starts_with("route"), 
               names_to = "route_number", 
               values_to = "route_name") %>%
  filter(!is.na(route_name)) 

```

#### the number of distinct stations that serve the A train
```{r}
a_train_stations <- reformatted_data %>%
  filter(route_name == "A") %>%
  distinct(station_name, line)

n_a_train_stations <- nrow(a_train_stations)
n_a_train_stations

```
**There are 60 distinct stations serve the A train**


```{r}
# Filter for ADA-compliant stations that serve the A train
ada_a_train_stations <- reformatted_data %>%
  filter(route_name == "A", ada == TRUE) %>%
  distinct(station_name, line)

n_ada_a_train_stations <- nrow(ada_a_train_stations)

n_ada_a_train_stations

```
**There are 17 stations that serve the A train are ADA compliant.**

# Problem 2

#### clean the Mr. Trash Wheel sheet

```{r}

mr_trash_wheel_data <- read_excel("202409 Trash Wheel Collection Data.xlsx", 
                                  sheet = 1,   
                                  skip = 1) %>%  
  janitor::clean_names()  

colnames(mr_trash_wheel_data)

mr_trash_wheel_data <- mr_trash_wheel_data %>%
  filter(!is.na(dumpster))

mr_trash_wheel_data <- mr_trash_wheel_data %>%
  mutate(sports_balls = as.integer(round(sports_balls)))
mr_trash_wheel_data <- mr_trash_wheel_data %>%
  select(-x15, -x16)

view(mr_trash_wheel_data)
```


#### clean theProfessor Trash Wheel sheet
```{r}
professor_trash_wheel_data <- read_excel("202409 Trash Wheel Collection Data.xlsx", 
                                         sheet = 2,   
                                         skip = 1) %>%  
  janitor::clean_names()  

colnames(professor_trash_wheel_data)

professor_trash_wheel_data <- professor_trash_wheel_data %>%
  filter(!is.na(dumpster))

view(professor_trash_wheel_data)

#no sports balls column
```

#### clean the gwynnda_trash_wheel Wheel sheet

```{r}
gwynnda_trash_wheel_data <- read_excel("202409 Trash Wheel Collection Data.xlsx", 
                                       sheet = 4,   
                                       skip = 1) %>%  
  janitor::clean_names()  
colnames(gwynnda_trash_wheel_data)
gwynnda_trash_wheel_data <- gwynnda_trash_wheel_data %>%
  filter(!is.na(dumpster))

view(gwynnda_trash_wheel_data)

#no sports_balls and glass bottles
```
#### creat a new data sheet

If we want to make a new table i should add a "sports_ball" column in professor_trash_wheel_data table and add "lass_bottles" "sports_balls" in gwynnda_trash_wheel_data table.

```{r}
mr_trash_wheel_data <- mr_trash_wheel_data %>%
  mutate(year = as.character(year))

professor_trash_wheel_data <- professor_trash_wheel_data %>%
  mutate(year = as.character(year))

gwynnda_trash_wheel_data <- gwynnda_trash_wheel_data %>%
  mutate(year = as.character(year))

professor_trash_wheel_data <- professor_trash_wheel_data %>%
  mutate(sports_balls = NA)

gwynnda_trash_wheel_data <- gwynnda_trash_wheel_data %>%
  mutate(glass_bottles = NA, sports_balls = NA)

combined_trash_wheel_data <- bind_rows(mr_trash_wheel_data, professor_trash_wheel_data, gwynnda_trash_wheel_data)

view(combined_trash_wheel_data)

```

Description of the new dataset:

The combined_trash_wheel_data combines data from the three sources: Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda Trash Wheel. 
The dataset contains 1,033 rows and 14 columns.
Key variables in the dataset include weight_tons, which records the weight of trash collected in tons, and volume_cubic_yards, representing the volume of trash collected in cubic yards. Additionally, the dataset contains variables like plastic_bottles (number of plastic bottles collected), cigarette_butts, and sports_balls, though some columns such as sports_balls and glass_bottles were missing from certain sources and have been filled with NA values where applicable.The variables sports_balls and glass_bottles were added to datasets that didnâ€™t originally have them, with missing data represented as NA.




#### The total weight of trash collected by Professor Trash Wheel
```{r}
total_weight_professor <- professor_trash_wheel_data %>%
  summarise(total_weight_tons = sum(weight_tons, na.rm = TRUE))

total_weight_professor
```
The total weight is 246.75 tons.

#### The total number of cigarette butts collected by Gwynnda in June of 2022
```{r}
total_cigarette_butts_gwynnda_june_2022 <- gwynnda_trash_wheel_data %>%
  filter(month == "June", year == "2022") %>%
  summarise(total_cigarette_butts = sum(cigarette_butts, na.rm = TRUE))

total_cigarette_butts_gwynnda_june_2022

```
The total number of cigarette is 18120 butts.


# Problem3

Delete the first two lines of results,csv and show all the columns name.
```{r}
results <- read.csv("results.csv", skip = 2)|> 
  janitor::clean_names()
bakes <- read.csv("bakes.csv")|>
  janitor::clean_names()
bakers <- read.csv("bakers.csv")|>
  janitor::clean_names()

colnames(results)
colnames(bakes)
colnames(bakers)
```
These lines of R code use the mutate() function to ensure that specific columns in the results, bakes, and bakers datasets are converted to the character data type and have consistent names for merging.
```{r}
results <- results |> setNames(c("series", "episode", "baker", "technical", "result")) #rename the variables of results and make them consist with other two fies.

bakes <- bakes |>
  mutate(series = as.numeric(series), episode = as.numeric(episode))

results <- results |>
  mutate(series = as.numeric(series), episode = as.numeric(episode))

bakers <- bakers |>
  mutate(baker = baker_name) |>
  mutate(series = as.numeric(series))

#change to first name
bakers <- bakers |>
  mutate(baker = word(baker, 1))
```



```{r}
#check for completeness and correctness across datasets (e.g. by viewing individual datasets and using anti_join
REBE <- anti_join(results, bakers, by = c("series", "baker")) |> nrow()
BERE <- anti_join(bakers, results, by = c("series", "baker")) |> nrow()
REBE
BERE
```
```{r}
# we can merge the bakers and results first , because there are too many missing data in bakes file.

bakeresults <- results |>
  left_join(bakers, by = c("series", "baker"))

view(bakeresults)
```

```{r}
# we will merge the bakes table with bakeresults table and make it in meaningful orders.
final_data <- bakeresults |>
  left_join(bakes, by = c("series", "episode", "baker")) |>
  select(series, episode, baker, baker_age, baker_occupation, hometown, 
         signature_bake, show_stopper, technical, result) |>
  arrange(series, episode, baker)

view(final_data)
```










